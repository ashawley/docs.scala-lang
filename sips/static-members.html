<!DOCTYPE html>
<html>
  <head>
    <title>SIP-30 - @static fields and methods in Scala objects (SI-4581) | Scala Documentation</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" type="image/png" href="/resources/favicon.ico">
    <link rel="shortcut icon" type="image/png" href="/resources/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/resources/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/resources/favicon-16x16.png">
    <link rel="manifest" href="/resources/site.webmanifest">
    <link rel="mask-icon" href="/resources/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#15a9ce">
    <meta name="theme-color" content="#ffffff">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!-- Custom stylesheet -->
    <link href="/resources/css/unslider-dots.css" rel="stylesheet" type="text/css">
    <link href="/resources/css/unslider.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/resources/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="/resources/css/style.css" type="text/css" />
    <link rel="stylesheet" href="/resources/css/monospace.css" type="text/css" />

    <!-- Atom feeds -->
    <link rel="alternate" type="application/atom+xml" title="News Feed" href="http://scala-lang.org/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Feed" href="http://scala-lang.org/feed/blog.xml" />

    <!-- Algolia stylesheet -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />


  </head>
  <body>


<div class="navigation-fade-screen"></div>

<header id="site-header">
  <div class="wrap">
    <nav class="navigation" role="menu">
      <a href="http://scala-lang.org" class="navigation-bdand">
        <img src="/resources/img/frontpage/scala-logo-white@2x.png" alt="">
      </a>
      <div class="navigation-panel-button">
        <i class="fa fa-bars"></i>
      </div>
      <ul class="navigation-menu">
        
            <li class="navigation-menu-item">
              <a href="/" class="active">Documentation</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/download/" >Download</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/community/" >Community</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://index.scala-lang.org" >Libraries</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/contribute/" >Contribute</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/blog/" >Blog</a>
            </li>
        
      </ul>
    </nav>
  </div>
</header>
<header id="doc-header">
  <div class="wrap" style="padding: 0px;">
    <nav class="doc-navigation" role="menu">
      <a href="/" class="navigation-bdand">
        <img src="/resources/img/documentation-logo@2x.png" alt="">
      </a>
      <div class="navigation-ellipsis">
        <i class="fa fa-ellipsis-v"></i>
      </div>
      <ul class="navigation-menu">
        
            <li class="navigation-menu-item">
              <a href="#" id="api" >API</a>
                
                <ul class="navigation-dropdown">
                
                  <li>
                    <a href="https://www.scala-lang.org/api/current/">Current</a>
                  </li>
                
                  <li>
                    <a href="https://www.scala-lang.org/files/archive/nightly/2.12.x/api/2.12.x/">Nightly</a>
                  </li>
                
                  <li>
                    <a href="/api/all.html">All Versions</a>
                  </li>
                
                </ul>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="#" id="learn" >Learn</a>
                
                <ul class="navigation-dropdown">
                
                  <li>
                    <a href="/getting-started.html">Getting Started</a>
                  </li>
                
                  <li>
                    <a href="/tour/tour-of-scala.html">Tour of Scala</a>
                  </li>
                
                  <li>
                    <a href="/tutorials/scala-for-java-programmers.html">Scala for Java Programmers</a>
                  </li>
                
                  <li>
                    <a href="/learn.html">Online Resources</a>
                  </li>
                
                </ul>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="#" id="reference" >Reference</a>
                
                <ul class="navigation-dropdown">
                
                  <li>
                    <a href="/overviews/index.html">Guides & Overviews</a>
                  </li>
                
                  <li>
                    <a href="/books.html">Books</a>
                  </li>
                
                  <li>
                    <a href="/tutorials/FAQ/index.html">Scala FAQs</a>
                  </li>
                
                  <li>
                    <a href="http://scala-lang.org/files/archive/spec/2.12/">Language Spec</a>
                  </li>
                
                </ul>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="/style/index.html" id="style guide" >Style Guide</a>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="/cheatsheets/index.html" id="cheatsheet" >Cheatsheet</a>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="/glossary/index.html" id="glossary" >Glossary</a>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="/sips/index.html" id="sips" >SIPs</a>
                
            </li>
        
      </ul>
    </nav>
    <nav class="doc-navigation-submenus">
      
        
          <ul class="navigation-submenu" id="api" style="display: none;">
            
              <li>
                <a href="https://www.scala-lang.org/api/current/">Current</a>
              </li>
            
              <li>
                <a href="https://www.scala-lang.org/files/archive/nightly/2.12.x/api/2.12.x/">Nightly</a>
              </li>
            
              <li>
                <a href="/api/all.html">All Versions</a>
              </li>
            
          </ul>
        
      
        
          <ul class="navigation-submenu" id="learn" style="display: none;">
            
              <li>
                <a href="/getting-started.html">Getting Started</a>
              </li>
            
              <li>
                <a href="/tour/tour-of-scala.html">Tour of Scala</a>
              </li>
            
              <li>
                <a href="/tutorials/scala-for-java-programmers.html">Scala for Java Programmers</a>
              </li>
            
              <li>
                <a href="/learn.html">Online Resources</a>
              </li>
            
          </ul>
        
      
        
          <ul class="navigation-submenu" id="reference" style="display: none;">
            
              <li>
                <a href="/overviews/index.html">Guides & Overviews</a>
              </li>
            
              <li>
                <a href="/books.html">Books</a>
              </li>
            
              <li>
                <a href="/tutorials/FAQ/index.html">Scala FAQs</a>
              </li>
            
              <li>
                <a href="http://scala-lang.org/files/archive/spec/2.12/">Language Spec</a>
              </li>
            
          </ul>
        
      
        
      
        
      
        
      
        
      
      <ul class="navigation-submenu ellipsis-menu" style="display: none;">
        
          
        
          
        
          
        
          
            <li><a href="/style/index.html">Style Guide</a></li>
          
        
          
            <li><a href="/cheatsheets/index.html">Cheatsheet</a></li>
          
        
          
            <li><a href="/glossary/index.html">Glossary</a></li>
          
        
          
            <li><a href="/sips/index.html">SIPs</a></li>
          
        
      </ul>
    </nav>
  </div>
</header>


<main id="inner-main">

  <!-- Title -->
  <section class="title-page">
    <div class="wrap">
      <div class="content-title-documentation">
        <div class="titles">
          
            <div class="supertitle">&nbsp;</div>
          
          <h1>SIP-30 - @static fields and methods in Scala objects (SI-4581)</h1>
        </div>
        <div class="language-dropdown">
          <div id="dd" class="wrapper-dropdown" tabindex="1">
            <span>Language</span>
              <ul class="dropdown"></ul>
          </div>
      </div>
    </div>
  </section>

  
  <section class="content">
	<div class="wrap">
		<div class="content-primary documentation">
			<div class="inner-box toc-context">
				<p><strong>Dmitry Petrashko, Sébastien Doeraene and Martin Odersky</strong></p>

<p><strong>first submitted 11 January 2016</strong></p>

<h2 id="motivation">Motivation</h2>

<p>We would like to allow methods and fields to be compiled as static. This is usable for interop with Java and other JVM languages, as well as with JavaScript, and is convenient for optimizations.</p>

<h2 id="use-cases">Use Cases</h2>

<p>Some JVM and JavaScript frameworks require classes to have specific static fields and/or methods.</p>

<p>For example, classes extending <code class="highlighter-rouge">android.os.Parcelable</code> are required to have a static field named <code class="highlighter-rouge">CREATOR</code> of type <code class="highlighter-rouge">android.os.Parcelable$Creator</code>.</p>

<p>Another example is using an <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReferenceFieldUpdater.html"><code class="highlighter-rouge">AtomicReferenceFieldUpdater</code></a>.</p>

<p>On the JavaScript side, one example is <a href="https://facebook.github.io/relay/docs/en/routing.html">Relay Route Definitions</a>, whose subclasses must define static fields such as <code class="highlighter-rouge">queries</code>.
Static methods and fields for JavaScript classes are one of the very few things (if not the only thing) that Scala.js “cannot do” at the moment, at least not declaratively.</p>

<h2 id="overview">Overview</h2>

<p>In order for a method or field to be considered static it needs to be defined in an <code class="highlighter-rouge">object</code> and annotated <code class="highlighter-rouge">@static</code>.
There is no special syntax proposed to access these members, they are accessed as if they were a member of defining objects with all appropriate access requirements for accessing them.</p>

<p>For example:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">Foo</span>

<span class="k">object</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="nd">@static</span> <span class="k">val</span> <span class="n">x</span> <span class="k">=</span> <span class="mi">5</span>
  <span class="nd">@static</span> <span class="k">def</span> <span class="n">bar</span><span class="o">(</span><span class="n">y</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="o">}</span>

<span class="n">println</span><span class="o">(</span><span class="nc">Foo</span><span class="o">.</span><span class="n">x</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="nc">Foo</span><span class="o">.</span><span class="n">bar</span><span class="o">(</span><span class="mi">12</span><span class="o">))</span></code></pre></figure>

<p>Intuitively, the presence of the <code class="highlighter-rouge">@static</code> annotation ensures that a field/method is declared as a static member of the companion class.
For the JVM, the above would therefore look to other Java code as if it had been declared with the following Java code:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">bar</span><span class="o">(</span><span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>In Scala.js, the <code class="highlighter-rouge">@static</code> annotation has no semantic effect in Scala objects, as they are not visible from JavaScript anyway (it could be used for optimizations).
It has a semantic effect on Scala.js-defined JS classes, for example:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="nd">@ScalaJSDefined</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="n">js</span><span class="o">.</span><span class="nc">Object</span>

<span class="nd">@ScalaJSDefined</span>
<span class="k">object</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="n">js</span><span class="o">.</span><span class="nc">Object</span> <span class="o">{</span>
  <span class="nd">@static</span> <span class="k">val</span> <span class="n">x</span> <span class="k">=</span> <span class="mi">5</span>
  <span class="nd">@static</span> <span class="k">def</span> <span class="n">bar</span><span class="o">(</span><span class="n">y</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="o">}</span></code></pre></figure>

<p>would look to JavaScript code as if it had been declared with the following JavaScript code:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">class</span> <span class="nx">Foo</span> <span class="kd">extends</span> <span class="nb">Object</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">bar</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">Foo</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// in ES6, there is no declarative syntax for static fields yet</span></code></pre></figure>

<h2 id="comparison-with-mirror-classes">Comparison with mirror classes</h2>

<p>Scalac currently generates static forwarders for fields and methods in top-level objects:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">object</span> <span class="nc">O</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">d</span> <span class="k">=</span> <span class="mi">1</span>
  <span class="k">object</span> <span class="nc">I</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">f</span> <span class="k">=</span> <span class="mi">1</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Under the proposed scheme users will be able to opt-in to have the field <code class="highlighter-rouge">f</code> defined in the inner object <code class="highlighter-rouge">I</code> emited as a static field.
In case <code class="highlighter-rouge">O.d</code> is annotated with <code class="highlighter-rouge">@static</code> the field will be created as a static field <code class="highlighter-rouge">d</code> in <code class="highlighter-rouge">class O</code>.
If not annotated, it will be created in the companion module with a static forwarder <code class="highlighter-rouge">d</code> in <code class="highlighter-rouge">class O</code>.</p>

<h2 id="restrictions">Restrictions</h2>

<p>The following rules ensure that methods can be correctly compiled into static members on both JVM and JavaScript:</p>

<ol>
  <li>
    <p>Only objects can have members annotated with <code class="highlighter-rouge">@static</code></p>
  </li>
  <li>
    <p>The fields annotated with <code class="highlighter-rouge">@static</code> should precede any non-<code class="highlighter-rouge">@static</code> fields. This ensures that we do not introduce surprises for users in initialization order of this class.</p>
  </li>
  <li>
    <p>The right hand side of a method or field annotated with <code class="highlighter-rouge">@static</code> can only refer to top-level classes, members of globally accessible objects and <code class="highlighter-rouge">@static</code> members. In particular, for non-static objects <code class="highlighter-rouge">this</code> is not accesible. <code class="highlighter-rouge">super</code> is never accessible.</p>
  </li>
  <li>
    <p>If a member <code class="highlighter-rouge">foo</code> of an <code class="highlighter-rouge">object C</code> is annotated with <code class="highlighter-rouge">@static</code>, the companion class <code class="highlighter-rouge">C</code> is not allowed to define term members with name <code class="highlighter-rouge">foo</code>.</p>
  </li>
  <li>
    <p>If a member <code class="highlighter-rouge">foo</code> of an <code class="highlighter-rouge">object C</code> is annotated with <code class="highlighter-rouge">@static</code>, the companion class <code class="highlighter-rouge">C</code> is not allowed to inherit classes that define a term member with name <code class="highlighter-rouge">foo</code>.</p>
  </li>
  <li>
    <p>Only <code class="highlighter-rouge">@static</code> methods and vals are supported in companions of traits. Java8 supports those, but not vars, and JavaScript does not have interfaces at all.</p>
  </li>
</ol>

<p>Note that because of platform requirements for JavaScript interop, rules <code class="highlighter-rouge">3</code> and <code class="highlighter-rouge">4</code> would be lifted for objects that have a companion class that inherits <code class="highlighter-rouge">js.Any</code>.</p>

<h2 id="compilation-scheme">Compilation scheme</h2>

<p>No modification of the typer is planned. The current proposed scheme piggybacks on already existing scoping restrictions in the typer, thus requiring <code class="highlighter-rouge">@static</code> methods to be defined in <code class="highlighter-rouge">object</code>s.</p>

<p>If implemented in the dotty code base, the following modifications would be needed:</p>

<ul>
  <li>extend <code class="highlighter-rouge">RefChecks</code> to check restrictions 1, 2, 4, 5 and 6. This can be done in a separate mini-phase;</li>
  <li>extend <code class="highlighter-rouge">LambdaLift.CollectDependencies</code> to be aware that accessing a member annotated <code class="highlighter-rouge">@static</code> should not trigger capturing the object that contains this member;</li>
  <li>extend <code class="highlighter-rouge">LambdaLift</code> to trigger an error if a method annotated with <code class="highlighter-rouge">@static</code> method cannot be lifted to the top level scope;</li>
  <li>extend <code class="highlighter-rouge">GenBCode</code> to emit static fields and methods in companion classes and forwarders to them in companion modules.</li>
</ul>

<h2 id="overriding--hiding">Overriding &amp; Hiding</h2>
<p>Java allows classes to define static methods with the same name and signature as a static method of a superclass. In order to define the semantics of such cases, the Java Specification introduces the notion of <a href="http://docs.oracle.com/javase/specs/jls/se8/html/jls-8.html#jls-8.4.8.2">hiding</a>.</p>

<p>This is required because in Java calling a <code class="highlighter-rouge">static</code> method on a class instance is supported.
This proposal does not need to introduce this notion as we do not support such calls.</p>

<h2 id="scalajs-and-jsstatic">Scala.js and @JSStatic</h2>
<p>As Scala.js needs this feature fast, a decision has been made to ship it under a name of <code class="highlighter-rouge">@JSStatic</code> before waiting for this SIP to be accepted and implemented in <code class="highlighter-rouge">scalac</code>. When this SIP is accepted and implemented in <code class="highlighter-rouge">scalac</code> the <code class="highlighter-rouge">@JSStatic</code> would become a deprecated type alias to <code class="highlighter-rouge">scala.static</code>.</p>

<h2 id="comparison-with-lrytzs-proposal">Comparison with <a href="https://gist.github.com/lrytz/80f3141de8240f9629da">@lrytz’s proposal</a></h2>
<p>Lukas Rytz has proposed a similar SIP, but his SIP requires changes to the typer to ensure that <code class="highlighter-rouge">@static</code> fields do not capture <code class="highlighter-rouge">this</code>, as in his proposal <code class="highlighter-rouge">@static</code> fields are defined in the class, rather than its companion object.
It also does not address the question of <code class="highlighter-rouge">@static</code> members in inner objects and inheritance/hiding of those methods in subclasses.</p>

<h2 id="open-questions">Open questions</h2>
<ul>
  <li>@static lazy val</li>
</ul>

<h2 id="initialization-order-discussion">Initialization order discussion</h2>
<p>In general, emission of static fields could affect the initialization order and change semantics.
This SIP solves this by enforcing (rule <code class="highlighter-rouge">2</code>) that <code class="highlighter-rouge">@static</code> fields and expressions precede non-static fields.
This means that no code precedes the <code class="highlighter-rouge">@static</code> field initialization which makes it hard to observe the difference between if the field is initialized statically or not,
since fields are initialized in the order <code class="highlighter-rouge">as written</code>, similar to how normal fields are initialized.</p>

<p>The <code class="highlighter-rouge">@static</code> proposal is similar to <code class="highlighter-rouge">@tailrec</code> in a sense that it fails compilation in the case where the user did not write code that follows the aforementioned rules.
These rules exist to enforce the unlikelyhood of an observable difference in semantics if <code class="highlighter-rouge">@static</code> annotations are dropped;
The restrictions in this SIP make it hard to observe changes in initialization within the same object.
It is still possible to observe those changes using multiple classes and side effects within initializers:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">C</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">x</span> <span class="k">=</span> <span class="o">{</span><span class="n">println</span><span class="o">(</span><span class="s">"x"</span><span class="o">);</span> <span class="mi">1</span> <span class="o">}</span>
<span class="o">}</span>


<span class="k">object</span> <span class="nc">O</span> <span class="k">extends</span> <span class="n">C</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">y</span> <span class="k">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">"y"</span><span class="o">);</span> <span class="mi">2</span> <span class="o">}</span>
  <span class="c1">// prints:
</span>  <span class="c1">// x
</span>  <span class="c1">// y
</span><span class="o">}</span>

<span class="k">object</span> <span class="nc">Os</span> <span class="k">extends</span> <span class="n">C</span> <span class="o">{</span>
  <span class="nd">@static</span> <span class="k">val</span> <span class="n">y</span> <span class="k">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">"y"</span><span class="o">);</span> <span class="mi">2</span> <span class="o">}</span>
   <span class="c1">// prints:
</span>   <span class="c1">// y
</span>   <span class="c1">// x
</span><span class="o">}</span></code></pre></figure>

<p>Static fields can be initialized earlier than they used to be initialized while being non-static, but never later.
By requiring <code class="highlighter-rouge">@static</code> first to be defined first inside the object,
we guarantee that you can’t observe the changes in initialization withing the same object without resorting to code which either uses <code class="highlighter-rouge">Unsafe</code> or exhibits undefined behaviour under the JVM.</p>

<h2 id="could-static-be-a-tailrec-like-annotation-that-doesnt-affect-code-generation-but-only-checks">Could <code class="highlighter-rouge">@static</code> be a <code class="highlighter-rouge">@tailrec</code>-like annotation that doesn’t affect code generation but only checks</h2>
<p>Unlike <code class="highlighter-rouge">@tailrec</code> this annotation does affect the binary API and dropping such an annotation would be a binary incompatible change. This is why authors believe that developers should be in full control of what is static.</p>

<h2 id="alternative-emitting-fields-of-objects-as-static-by-default">Alternative: Emitting fields of objects as static by default</h2>
<p>An alternative to this proposal would be to emit all the fields defined in objects as static.
Unfortunately this gets us under dark waters when we try to figure out in the following example:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">Super</span> <span class="o">{</span>
 <span class="k">val</span> <span class="n">c</span> <span class="k">=</span> <span class="o">{</span><span class="n">println</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span> <span class="mi">1</span><span class="o">}</span>
<span class="o">}</span>
<span class="k">object</span> <span class="nc">Object</span> <span class="k">extends</span> <span class="nc">Super</span> <span class="o">{</span>
 <span class="k">override</span> <span class="k">val</span> <span class="n">c</span> <span class="k">=</span> <span class="o">{</span><span class="n">println</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span> <span class="mi">2</span><span class="o">}</span>
 <span class="k">val</span> <span class="n">d</span> <span class="k">=</span> <span class="o">{</span><span class="n">println</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span> <span class="mi">2</span><span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Let’s consider possible options:</p>

<ul>
  <li>if the field <code class="highlighter-rouge">c</code> is emitted as <code class="highlighter-rouge">static</code> on the bytecode level, it will be initialized before the <code class="highlighter-rouge">c</code> in superclass is initialized, reordering side-effects in initializers;</li>
  <li>if the field <code class="highlighter-rouge">c</code> is <em>not</em> emitted as <code class="highlighter-rouge">static</code> but the field <code class="highlighter-rouge">d</code> is, then the order of initialization would also be affected, reordering side-effects.</li>
</ul>

<p>Based on the previous study done in preparation for this SIP, the authors believe that the only reasonable way to maintain current semantics would be to say that such alternative would require these rules:</p>

<ul>
  <li>only the fields which were not declared by parents of the object can be emitted as static;</li>
  <li>only fields that are lexically defined before any non-static field or statement in the body can be emitted as static.</li>
</ul>

<p>Authors believe that the alternative would require the same effort to implement, but will be less intuitive to users and harder to control as, for example, reordering fields in object might not be binary compatible.</p>

<h2 id="see-also">See Also</h2>
<ul>
  <li><a href="https://issues.scala-lang.org/browse/SI-4581">SI-4581</a> is a request for a <code class="highlighter-rouge">@static</code> annotation</li>
  <li><a href="https://github.com/scala-js/scala-js/issues/1902">Scala.js issue #1902</a> is a request for defining static fields in Scala.js-defined JS classes</li>
  <li><a href="https://gist.github.com/lrytz/80f3141de8240f9629da">Another proposal by @lrytz</a></li>
  <li><a href="https://groups.google.com/forum/#!searchin/scala-internals/static/scala-internals/vOps4k8CADY/Dq1I3Ysvao0J">Old discussion on scala-internals mailing list</a></li>
  <li><a href="https://groups.google.com/forum/#!searchin/scala-internals/static/scala-internals/Y3OlFWPvnyM/tGE5BQw4Pe0J">Another discussion of scala-internals mailing list</a></li>
</ul>

			</div>
		</div>

		<!-- TOC -->
    <div class="content-nav">
    	<div class="inner-box sidebar-toc-wrapper sip-toc" style="">
      
        <h5 class="contents">SIP Committee Decision</h5>
         <div class="tag" style="background-color: #b58900">Under Review</div>
           <p class="vote-text" style="color: #b58900">
             Authors need to update the proposal before the next review.
           </p>
        
    		<h5 class="contents">SIP Contents</h5>
    		<div class="inner-toc" id="sidebar-toc">
          <div id="toc"></div>
    		</div>
    		<hr>
    		<div class="help-us"><a href="https://github.com/scala/docs.scala-lang/blob/master/_sips/sips/2016-01-11-static-members.md"><i class="fa fa-pencil" aria-hidden="true"></i> Problem with this page?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please help us fix it!</a></div>
    	</div>
    </div>

	</div>
</section>


</main>

<footer id="site-footer">
    <div class="wrap">
      <div class="site-footer-top">
        
          <ul class="documentation">
            <li><h3>Documentation</h3></li>
            
              <li><a href="/getting-started.html">Getting Started</a></li>
            
              <li><a href="https://www.scala-lang.org/api/current/index.html">API</a></li>
            
              <li><a href="/overviews">Overviews/Guides</a></li>
            
              <li><a href="http://scala-lang.org/files/archive/spec/2.12/">Language Specification</a></li>
            
          </ul>
        
          <ul class="download">
            <li><h3>Download</h3></li>
            
              <li><a href="http://scala-lang.org/download/">Current Version</a></li>
            
              <li><a href="http://scala-lang.org/download/all.html">All versions</a></li>
            
          </ul>
        
          <ul class="community">
            <li><h3>Community</h3></li>
            
              <li><a href="http://scala-lang.org/community/">Community</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#mailing-lists">Mailing Lists</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#chat-rooms">Chat Rooms & More</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#community-libraries-and-tools">Libraries and Tools</a></li>
            
              <li><a href="http://scala.epfl.ch/">The Scala Center</a></li>
            
          </ul>
        
          <ul class="contribute">
            <li><h3>Contribute</h3></li>
            
              <li><a href="http://scala-lang.org/contribute/">How to help</a></li>
            
              <li><a href="http://scala-lang.org/contribute/bug-reporting-guide.html">Report an Issue</a></li>
            
          </ul>
        
          <ul class="scala">
            <li><h3>Scala</h3></li>
            
              <li><a href="http://scala-lang.org/blog/">Blog</a></li>
            
              <li><a href="http://scala-lang.org/conduct/">Code of Conduct</a></li>
            
              <li><a href="http://scala-lang.org/license/">License</a></li>
            
          </ul>
        
          <ul class="social">
            <li><h3>Social</h3></li>
            
              <li><a href="https://github.com/scala/scala">GitHub</a></li>
            
              <li><a href="https://twitter.com/scala_lang">Twitter</a></li>
            
          </ul>
        
      </div>
      <div class="site-footer-bottom">
        <p></p>
        <img src="/resources/img/frontpage/scala-logo-white.png" alt="">
      </div>
    </div>
    <a class="back-to-top in" href="#" id="scroll-to-top-btn">
      <i class="fa fa-angle-up"></i>
    </a>
</footer>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
<script>(window.jQuery) || document.write('<script src="/scripts/jquery-3.1.1.min.js"><\/script>');</script>
<script src="/resources/js/vendor/jquery.autocomplete.js" type="text/javascript"></script>

<!-- moment js -->
<script src="/resources/js/vendor/moment.min.js" type="text/javascript"></script>

<!-- tweet feed -->
<script src="/resources/js/tweetMachine-update.js" type="text/javascript"></script>

<!-- prettify js -->
<script src="/resources/js/vendor/prettify/prettify.js" type="text/javascript"></script>
<script src="/resources/js/vendor/prettify/lang-scala.js" type="text/javascript"></script>

<!-- unslider js -->
<script src="/resources/js/vendor/unslider.js" type="text/javascript"></script>

<!-- Highlight -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/scala.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/java.min.js" type="text/javascript"></script>

<!-- CodeMirror -->
<script src="/resources/js/vendor/codemirror/codemirror.js" type="text/javascript"></script>
<script src="/resources/js/vendor/codemirror/clike.js" type="text/javascript"></script>

<!-- TOC -->
<script src="/resources/js/vendor/jquery.sticky.js" type="text/javascript"></script>
<script src="/resources/js/vendor/toc.js" type="text/javascript"></script>

<!-- Blog search -->
<script src="/resources/js/vendor/jekyll.search.min.js" type="text/javascript"></script>

<!-- Custom javascript -->
<script src="/resources/js/functions.js" type="text/javascript"></script>



<!-- Alogolia search for doc -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: 'fbc439670f5d4e3730cdcb715c359391',
indexName: 'scala-lang',
inputSelector: '#doc-search-bar',
algoliaOptions: { 'facetFilters': ["language:en"] },
debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
</body>

</html>

