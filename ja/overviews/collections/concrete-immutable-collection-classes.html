<!DOCTYPE html>
<html>
  <head>
    <title>具象不変コレクションクラス | Scala Documentation</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" type="image/png" href="/docs.scala-lang/resources/favicon.ico">
    <link rel="shortcut icon" type="image/png" href="/docs.scala-lang/resources/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/docs.scala-lang/resources/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/docs.scala-lang/resources/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/docs.scala-lang/resources/favicon-16x16.png">
    <link rel="manifest" href="/docs.scala-lang/resources/site.webmanifest">
    <link rel="mask-icon" href="/docs.scala-lang/resources/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#15a9ce">
    <meta name="theme-color" content="#ffffff">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!-- Custom stylesheet -->
    <link href="/docs.scala-lang/resources/css/unslider-dots.css" rel="stylesheet" type="text/css">
    <link href="/docs.scala-lang/resources/css/unslider.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/docs.scala-lang/resources/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="/docs.scala-lang/resources/css/style.css" type="text/css" />
    <link rel="stylesheet" href="/docs.scala-lang/resources/css/monospace.css" type="text/css" />

    <!-- Atom feeds -->
    <link rel="alternate" type="application/atom+xml" title="News Feed" href="http://scala-lang.org/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Feed" href="http://scala-lang.org/feed/blog.xml" />

    <!-- Algolia stylesheet -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />


  </head>
  <body>


<div class="navigation-fade-screen"></div>

<header id="site-header">
  <div class="wrap">
    <nav class="navigation" role="menu">
      <a href="http://scala-lang.org" class="navigation-bdand">
        <img src="/docs.scala-lang/resources/img/frontpage/scala-logo-white@2x.png" alt="">
      </a>
      <div class="navigation-panel-button">
        <i class="fa fa-bars"></i>
      </div>
      <ul class="navigation-menu">
        
            <li class="navigation-menu-item">
              <a href="/docs.scala-lang/" class="active">Documentation</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/download/" >Download</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/community/" >Community</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://index.scala-lang.org" >Libraries</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/contribute/" >Contribute</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/blog/" >Blog</a>
            </li>
        
      </ul>
    </nav>
  </div>
</header>
<header id="doc-header">
  <div class="wrap" style="padding: 0px;">
    <nav class="doc-navigation" role="menu">
      <a href="/docs.scala-lang/" class="navigation-bdand">
        <img src="/docs.scala-lang/resources/img/documentation-logo@2x.png" alt="">
      </a>
      <div class="navigation-ellipsis">
        <i class="fa fa-ellipsis-v"></i>
      </div>
      <ul class="navigation-menu">
        
            <li class="navigation-menu-item">
              <a href="#" id="api" >API</a>
                
                <ul class="navigation-dropdown">
                
                  <li>
                    <a href="https://www.scala-lang.org/api/current/">Current</a>
                  </li>
                
                  <li>
                    <a href="https://www.scala-lang.org/files/archive/nightly/2.12.x/api/2.12.x/">Nightly</a>
                  </li>
                
                  <li>
                    <a href="/docs.scala-lang/api/all.html">All Versions</a>
                  </li>
                
                </ul>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="#" id="learn" >Learn</a>
                
                <ul class="navigation-dropdown">
                
                  <li>
                    <a href="/docs.scala-lang/getting-started.html">Getting Started</a>
                  </li>
                
                  <li>
                    <a href="/docs.scala-lang/tour/tour-of-scala.html">Tour of Scala</a>
                  </li>
                
                  <li>
                    <a href="/docs.scala-lang/tutorials/scala-for-java-programmers.html">Scala for Java Programmers</a>
                  </li>
                
                  <li>
                    <a href="/docs.scala-lang/learn.html">Online Resources</a>
                  </li>
                
                </ul>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="#" id="reference" >Reference</a>
                
                <ul class="navigation-dropdown">
                
                  <li>
                    <a href="/docs.scala-lang/overviews/index.html">Guides & Overviews</a>
                  </li>
                
                  <li>
                    <a href="/docs.scala-lang/books.html">Books</a>
                  </li>
                
                  <li>
                    <a href="/docs.scala-lang/tutorials/FAQ/index.html">Scala FAQs</a>
                  </li>
                
                  <li>
                    <a href="http://scala-lang.org/files/archive/spec/2.12/">Language Spec</a>
                  </li>
                
                </ul>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="/docs.scala-lang/style/index.html" id="style guide" >Style Guide</a>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="/docs.scala-lang/cheatsheets/index.html" id="cheatsheet" >Cheatsheet</a>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="/docs.scala-lang/glossary/index.html" id="glossary" >Glossary</a>
                
            </li>
        
            <li class="navigation-menu-item">
              <a href="/docs.scala-lang/sips/index.html" id="sips" >SIPs</a>
                
            </li>
        
      </ul>
    </nav>
    <nav class="doc-navigation-submenus">
      
        
          <ul class="navigation-submenu" id="api" style="display: none;">
            
              <li>
                <a href="https://www.scala-lang.org/api/current/">Current</a>
              </li>
            
              <li>
                <a href="https://www.scala-lang.org/files/archive/nightly/2.12.x/api/2.12.x/">Nightly</a>
              </li>
            
              <li>
                <a href="/docs.scala-lang/api/all.html">All Versions</a>
              </li>
            
          </ul>
        
      
        
          <ul class="navigation-submenu" id="learn" style="display: none;">
            
              <li>
                <a href="/docs.scala-lang/getting-started.html">Getting Started</a>
              </li>
            
              <li>
                <a href="/docs.scala-lang/tour/tour-of-scala.html">Tour of Scala</a>
              </li>
            
              <li>
                <a href="/docs.scala-lang/tutorials/scala-for-java-programmers.html">Scala for Java Programmers</a>
              </li>
            
              <li>
                <a href="/docs.scala-lang/learn.html">Online Resources</a>
              </li>
            
          </ul>
        
      
        
          <ul class="navigation-submenu" id="reference" style="display: none;">
            
              <li>
                <a href="/docs.scala-lang/overviews/index.html">Guides & Overviews</a>
              </li>
            
              <li>
                <a href="/docs.scala-lang/books.html">Books</a>
              </li>
            
              <li>
                <a href="/docs.scala-lang/tutorials/FAQ/index.html">Scala FAQs</a>
              </li>
            
              <li>
                <a href="http://scala-lang.org/files/archive/spec/2.12/">Language Spec</a>
              </li>
            
          </ul>
        
      
        
      
        
      
        
      
        
      
      <ul class="navigation-submenu ellipsis-menu" style="display: none;">
        
          
        
          
        
          
        
          
            <li><a href="/docs.scala-lang/style/index.html">Style Guide</a></li>
          
        
          
            <li><a href="/docs.scala-lang/cheatsheets/index.html">Cheatsheet</a></li>
          
        
          
            <li><a href="/docs.scala-lang/glossary/index.html">Glossary</a></li>
          
        
          
            <li><a href="/docs.scala-lang/sips/index.html">SIPs</a></li>
          
        
      </ul>
    </nav>
  </div>
</header>


<main id="inner-main">

  <!-- Title -->
  <section class="title-page">
    <div class="wrap">
      <div class="content-title-documentation">
        <div class="titles">
          
            <div class="supertitle">Collections</div>
          
          <h1>具象不変コレクションクラス</h1>
        </div>
        <div class="language-dropdown">
          <div id="dd" class="wrapper-dropdown" tabindex="1">
            <span>Language</span>
              <ul class="dropdown"></ul>
          </div>
      </div>
    </div>
  </section>

  
  <section class="content">
	<div class="wrap">
		<div class="content-primary documentation">
			<div class="inner-box">
				<div class="toc-context">
					<p>Scala は様々な具象不変コレクションクラス (concrete immutable collection class) を提供する。これらはどのトレイトを実装するか（マップ、集合、列）、無限を扱えるか、様々な演算の速さなどの違いがある。ここに、Scala で最もよく使われる不変コレクション型を並べる。</p>

<h2 id="リスト">リスト</h2>

<p>リスト (<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/List.html"><code class="highlighter-rouge">List</code></a>) は有限の不変列だ。リストは最初の要素とリストの残りの部分に定数時間でアクセスでき、また、新たな要素をリストの先頭に追加する定数時間の cons 演算を持つ。他の多くの演算は線形時間で行われる。</p>

<p>リストは Scala プログラミングの働き者であり続けてきたので、あえてここで語るべきことは多くない。Scala 2.8 での大きな変更点は <code class="highlighter-rouge">List</code> クラスはそのサブクラスである <code class="highlighter-rouge">::</code> とそのサブオブジェクトである <code class="highlighter-rouge">Nil</code> とともに、論理的にふさわしい <code class="highlighter-rouge">scala.collection.immutable</code> パッケージで定義されるようになったことだ。<code class="highlighter-rouge">scala</code> パッケージには <code class="highlighter-rouge">List</code>、<code class="highlighter-rouge">Nil</code>、および <code class="highlighter-rouge">::</code> へのエイリアスがあるため、ユーザの立場から見ると、リストは今まで通り使うことができる。</p>

<p>もう一つの変更点は、リストは以前のような特殊扱いではなく、コレクションフレームワークにより緊密に統合されたことだ。例えば、<code class="highlighter-rouge">List</code> のコンパニオンオブジェクトにあった多くのメソッドは廃止予定になった。代わりに、それらは全てのコレクションが継承する<a href="creating-collections-from-scratch.html">共通作成メソッド</a>に取って代わられた。</p>

<h2 id="ストリーム">ストリーム</h2>

<p>ストリーム (<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/Stream.html"><code class="highlighter-rouge">Stream</code></a>) はリストに似ているが、要素は遅延評価される。そのため、ストリームは無限の長さをもつことができる。呼び出された要素のみが計算される。他の点においては、ストリームはリストと同じ性能特性をもつ。</p>

<p>リストは <code class="highlighter-rouge">::</code> 演算子によって構築されるが、ストリームはそれに似た <code class="highlighter-rouge">#::</code> 演算子によって構築される。以下は、整数の 1, 2, 3 からなる簡単なストリームの例だ:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val str = 1 #:: 2 #:: 3 #:: Stream.empty
str: scala.collection.immutable.Stream[Int] = Stream(1, ?)
</code></pre></div></div>

<p>このストリームの head は 1 で、tail は 2 と 3 だ。上の例では tail が表示されていないが、それはまだ計算されていないからだ。ストリームは遅延評価されるため、<code class="highlighter-rouge">toString</code> は余計な評価を強いないように慎重に設計されているのだ。</p>

<p>以下に、もう少し複雑な例を示す。任意の二つの数から始まるフィボナッチ数列を計算するストリームだ。フィボナッチ数列とは、それぞれの要素がその前二つの要素の和である数列のことだ。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; def fibFrom(a: Int, b: Int): Stream[Int] = a #:: fibFrom(b, a + b)
fibFrom: (a: Int,b: Int)Stream[Int]
</code></pre></div></div>

<p>この関数は嘘のように単純だ。数列の最初の要素は明らかに <code class="highlighter-rouge">a</code> で、残りは <code class="highlighter-rouge">b</code> そして <code class="highlighter-rouge">a + b</code> から始まるフィボナッチ数列だ。無限の再帰呼び出しに陥らずにこの数列を計算するのが難しい所だ。もしこの関数が <code class="highlighter-rouge">#::</code> の代わりに <code class="highlighter-rouge">::</code> を使っていたなら、全ての呼び出しはまた別の呼び出しを招くため、無限の再帰呼び出しに陥ってしまう。しかし、<code class="highlighter-rouge">#::</code>
を使っているため、右辺は呼び出されるまでは評価されないのだ。</p>

<p>2つの 1 から始まるフィボナッチ数列の最初の数要素を以下に示す:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val fibs = fibFrom(1, 1).take(7)
fibs: scala.collection.immutable.Stream[Int] = Stream(1, ?)
scala&gt; fibs.toList
res9: List[Int] = List(1, 1, 2, 3, 5, 8, 11)
</code></pre></div></div>

<h2 id="ベクトル">ベクトル</h2>

<p>リストはアルゴリズムが慎重にリストの先頭要素 (<code class="highlighter-rouge">head</code>) のみを処理する場合、非常に効率的だ。<code class="highlighter-rouge">head</code> の読み込み、追加、および削除は一定数時間で行われるのに対して、リストの後続の要素に対する読み込みや変更は、その要素の深さに依存した線形時間で実行される。</p>

<p>ベクトル (<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/Vector.html"><code class="highlighter-rouge">Vector</code></a>) は、ランダムアクセス時の非効率性を解決するために Scala 2.8 から導入された新しいコレクション型だ。ベクトルはどの要素の読み込みも「事実上」定数時間で行う。リストの <code class="highlighter-rouge">head</code> の読み込みや配列の要素読み込みに比べると大きい定数だが、定数であることには変りない。この結果、ベクトルを使ったアルゴリズムは列の <code class="highlighter-rouge">head</code> のみを読み込むことに神経質にならなくていい。任意の場所の要素を読み込んだり、変更したりできるため、コードを書くのに便利だ。</p>

<p>ベクトルは、他の列と同じように作成され、変更される。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val vec = scala.collection.immutable.Vector.empty
vec: scala.collection.immutable.Vector[Nothing] = Vector()
scala&gt; val vec2 = vec :+ 1 :+ 2
vec2: scala.collection.immutable.Vector[Int] = Vector(1, 2)
scala&gt; val vec3 = 100 +: vec2
vec3: scala.collection.immutable.Vector[Int] = Vector(100, 1, 2)
scala&gt; vec3(0)
res1: Int = 100
</code></pre></div></div>

<p>ベクトルは分岐度の高い木構造で表される。全てのノードは32以下の要素か、32以下の他のノードを格納する。32個以下の要素を持つベクトルは単一のノードで表すことができる。ベクトルは、たった一つの間接呼び出しで、<code class="highlighter-rouge">32 * 32 = 1024</code>個までの要素を扱うことができる。木構造の根ノードから末端ノードまで 2ホップで <i>2<sup>15</sup></i>個、3ホップで <i>2<sup>20</sup></i>個、4ホップで
<i>2<sup>30</sup></i>個以下までの要素をベクトルは扱うことができる。よって、普通のサイズのベクトルの要素選択は 5回以内の配列選択で行うことができる。要素選択が「事実上定数時間」と言ったのは、こういうことだ。</p>

<p>ベクトルは不変であるため、ベクトルの変更無しにベクトル内の要素を変更することはできない。しかし、<code class="highlighter-rouge">updated</code> メソッドを使うことで一つの要素違いの新たなベクトルを作成することができる:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val vec = Vector(1, 2, 3)
vec: scala.collection.immutable.Vector[Int] = Vector(1, 2, 3)
scala&gt; vec updated (2, 4)
res0: scala.collection.immutable.Vector[Int] = Vector(1, 2, 4)
scala&gt; vec
res1: scala.collection.immutable.Vector[Int] = Vector(1, 2, 3)
</code></pre></div></div>

<p>最後の行が示すように、<code class="highlighter-rouge">updated</code> の呼び出しは元のベクトル <code class="highlighter-rouge">vec</code> には一切影響しない。読み込みと同様に、ベクトルの関数型更新も「事実上定数時間」で実行される。ベクトルの真ん中にある要素を更新するには、その要素を格納するノードと、木構造の根ノードからを初めとする全ての親ノードをコピーすることによって行われる。これは関数型更新は、32以内の要素か部分木を格納する 1 〜 5個の ノードを作成することを意味する。これは、可変配列の in-place での上書きに比べると、ずっと時間のかかる計算であるが、ベクトル全体をコピーするよりはずっと安いものだ。</p>

<p>ベクトルは高速なランダム読み込みと高速な関数型更新の丁度いいバランスを取れているため、不変添字付き列 (<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/IndexedSeq.html"><code class="highlighter-rouge">immutable.IndexedSeq</code></a>) トレイトのデフォルトの実装となっている:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; collection.immutable.IndexedSeq(1, 2, 3)
res2: scala.collection.immutable.IndexedSeq[Int] = Vector(1, 2, 3)
</code></pre></div></div>

<h2 id="不変スタック">不変スタック</h2>

<p>後入れ先出し (LIFO: last in first out) の列が必要ならば、スタック (<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/Stack.html"><code class="highlighter-rouge">Stack</code></a>) がある。 <code class="highlighter-rouge">push</code> メソッドを使ってスタックに要素をプッシュ、<code class="highlighter-rouge">pop</code> を使ってポップ、そして<code class="highlighter-rouge">top</code> を使って削除することなく一番上の要素を読み込むことができる。これらの演算は、全て定数時間で行われる。</p>

<p>以下はスタックに対して行われる簡単な演算の例だ:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val stack = scala.collection.immutable.Stack.empty
stack: scala.collection.immutable.Stack[Nothing] = Stack()
scala&gt; val hasOne = stack.push(1)
hasOne: scala.collection.immutable.Stack[Int] = Stack(1)
scala&gt; stack
stack: scala.collection.immutable.Stack[Nothing] = Stack()
scala&gt; hasOne.top
res20: Int = 1
scala&gt; hasOne.pop
res19: scala.collection.immutable.Stack[Int] = Stack()
</code></pre></div></div>

<p>機能的にリストとかぶるため、不変スタックが Scala のプログラムで使われることは稀だ: 不変スタックの <code class="highlighter-rouge">push</code> はリストの <code class="highlighter-rouge">::</code> と同じで、<code class="highlighter-rouge">pop</code> はリストの <code class="highlighter-rouge">tail</code> と同じだ。</p>

<h2 id="不変キュー">不変キュー</h2>

<p>キュー (<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/Queue.html"><code class="highlighter-rouge">Queue</code></a>) はスタックに似ているが、後入れ先出し (LIFO: last in first out) ではなく、先入れ先出し (FIFO:
first in first out) だ。</p>

<p>以下に空の不変キューの作り方を示す:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val empty = scala.collection.immutable.Queue[Int]()
empty: scala.collection.immutable.Queue[Int] = Queue()
</code></pre></div></div>

<p><code class="highlighter-rouge">enqueue</code> を使って不変キューに要素を追加することができる:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val has1 = empty.enqueue(1)
has1: scala.collection.immutable.Queue[Int] = Queue(1)
</code></pre></div></div>

<p>複数の要素をキューに追加するには、enqueue の引数にコレクションを渡す:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val has123 = has1.enqueue(List(2, 3))
has123: scala.collection.immutable.Queue[Int]
  = Queue(1, 2, 3)
</code></pre></div></div>

<p>キューの先頭から要素を削除するには、<code class="highlighter-rouge">dequeue</code> を使う:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val (element, has23) = has123.dequeue
element: Int = 1
has23: scala.collection.immutable.Queue[Int] = Queue(2, 3)
</code></pre></div></div>

<p><code class="highlighter-rouge">dequeue</code> は削除された要素と残りのキューのペアを返すことに注意してほしい。</p>

<h2 id="範囲">範囲</h2>

<p>範囲 (<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/Range.html"><code class="highlighter-rouge">Range</code></a>) は順序付けされた等間隔の整数の列だ。例えば、「1、2、3」は範囲であり、「5、8、11、14」も範囲だ。Scala で範囲を作成するには、予め定義された <code class="highlighter-rouge">to</code> メソッドと <code class="highlighter-rouge">by</code> メソッドを使う。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; 1 to 3
res2: scala.collection.immutable.Range.Inclusive = Range(1, 2, 3)
scala&gt; 5 to 14 by 3
res3: scala.collection.immutable.Range = Range(5, 8, 11, 14)
</code></pre></div></div>

<p>上限を含まない範囲を作成したい場合は、<code class="highlighter-rouge">to</code> の代わりに、便宜上用意された <code class="highlighter-rouge">until</code> メソッドを使う:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; 1 until 3
res2: scala.collection.immutable.Range = Range(1, 2)
</code></pre></div></div>

<p>範囲は、開始値、終了値、ステップ値という、たった三つの数で定義できため定数空間で表すことができる。そのため、範囲の多くの演算は非常に高速だ。</p>

<h2 id="ハッシュトライ">ハッシュトライ</h2>

<p>ハッシュトライは不変集合と不変マップを効率的に実装する標準的な方法だ。ハッシュトライは、<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/HashMap.html"><code class="highlighter-rouge">immutable.HashMap</code></a> クラスによりサポートされている。データ構造は、全てのノードに 32個の要素か 32個の部分木があるという意味でベクトルに似ている。しかし、キーの選択はハッシュコードにより行われる。たとえば、マップから任意のキーを検索する場合、まずキーのハッシュコードを計算する。その後、最初の部分木を選択するのにハッシュコードの下位 5ビットが使われ、次の 5ビットで次の部分木が選択される、という具合だ。ノード内の全ての要素が、その階層までで選ばれているビット範囲内でお互いと異なるハッシュコードを持った時点で選択は終了する。</p>

<p>ハッシュトライは、サイズ相応の高速な検索と、相応に効率的な関数型加算 <code class="highlighter-rouge">(+)</code> と減算 <code class="highlighter-rouge">(-)</code> の調度良いバランスが取れている。そのため、ハッシュトライは Scala の不変マップと不変集合のデフォルトの実装を支えている。実は、Scala は要素が 5個未満の不変集合と不変マップに関して、更なる最適化をしている。1 〜 4個の要素を持つ集合とセットは、要素 (マップの場合は、キー/値のペア) をフィールドとして持つ単一のオブジェクトとして格納する。空の不変集合と、空の不変マップは、ぞれぞれ単一のオブジェクトである。空の不変集合や不変マップは、空であり続けるため、データ構造を複製する必要はない。</p>

<h2 id="赤黒木">赤黒木</h2>

<p>赤黒木は、ノードが「赤」か「黒」に色付けされている平衡二分木の一種だ。他の平衡二分木と同様に演算は木のサイズのログ時間内に確実に完了する。</p>

<p>Scala は内部で赤黒木を使った不変集合と不変マップの実装を提供する。<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/TreeSet.html"><code class="highlighter-rouge">TreeSet</code></a> と <a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/TreeMap.html"><code class="highlighter-rouge">TreeMap</code></a> クラスがそれだ。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; scala.collection.immutable.TreeSet.empty[Int]
res11: scala.collection.immutable.TreeSet[Int] = TreeSet()
scala&gt; res11 + 1 + 3 + 3
res12: scala.collection.immutable.TreeSet[Int] = TreeSet(1, 3)
</code></pre></div></div>

<p>赤黒木は、全ての要素をソートされた順序で返す効率的なイテレータを提供するため、整列済み集合 (<code class="highlighter-rouge">SortedSet</code>)
の標準実装となっている。</p>

<h2 id="不変ビット集合">不変ビット集合</h2>

<p>ビット集合 (<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/BitSet.html"><code class="highlighter-rouge">BitSet</code></a>) は大きい整数のビットを小さな整数のコレクションを使って表す。例えば、3, 2, と 0 を格納するビット集合は二進法で整数の 1101、十進法で 13 を表す。</p>

<p>内部では、ビット集合は 64ビットの <code class="highlighter-rouge">Long</code> の配列を使っている。配列の最初の <code class="highlighter-rouge">Long</code> は 整数の 0〜63、二番目は 64〜127 という具合だ。そのため、ビット集合は最大値が数百以下の場合は非常にコンパクトだ。</p>

<p>ビット集合の演算はとても高速だ。所属判定は一定数時間で行われる。集合への要素の追加は、ビット集合の配列内の <code class="highlighter-rouge">Long</code> の数に比例するが、普通は小さい数だ。以下にビット集合の使用例を示す:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val bits = scala.collection.immutable.BitSet.empty
bits: scala.collection.immutable.BitSet = BitSet()
scala&gt; val moreBits = bits + 3 + 4 + 4
moreBits: scala.collection.immutable.BitSet = BitSet(3, 4)
scala&gt; moreBits(3)
res26: Boolean = true
scala&gt; moreBits(0)
res27: Boolean = false
</code></pre></div></div>

<h2 id="リストマップ">リストマップ</h2>

<p>リストマップ (<a href="http://www.scala-lang.org/api/2.12.2/scala/collection/immutable/ListMap.html"><code class="highlighter-rouge">ListMap</code></a>) は、キー/値ペアの連結リスト (linked list) により実装されたマップを表す。一般的に、リストマップの演算はリスト全体を総なめする必要がある可能性がある。そのため、リストマップの演算はマップのサイズに対して線形時間をとる。標準の不変マップの方が常に高速なので Scala のリストマップが使われることはほとんど無い。唯一性能の差が出る可能性としては、マップが何らかの理由でリストの最初の要素が他の要素に比べてずっと頻繁に読み込まれるように構築された場合だ。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; val map = scala.collection.immutable.ListMap(1-&gt;"one", 2-&gt;"two")
map: scala.collection.immutable.ListMap[Int,java.lang.String] =
   Map(1 -&gt; one, 2 -&gt; two)
scala&gt; map(2)
res30: String = "two"
</code></pre></div></div>

				</div>

				<div class="content-contributors">
    <h3>Contributors to this page:</h3>
    <div id="contributors" class="contributors-container"></div>
</div>

			</div>
		</div>

		<!-- TOC -->
		<div class="content-nav">
	<div class="inner-box sidebar-toc-wrapper" style="">
		<h5 class="contents">Contents</h5>
		<div class="inner-toc" id="sidebar-toc">

      <ul>
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/introduction.html">はじめに</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/overview.html">可変コレクションおよび不変コレクション</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/trait-traversable.html">Traversable トレイト</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/trait-iterable.html">Iterable トレイト</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/seqs.html">列トレイト Seq、IndexedSeq、および LinearSeq</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/sets.html">集合</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/maps.html">マップ</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/concrete-immutable-collection-classes.html">具象不変コレクションクラス</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            <div id="toc"></div>
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/concrete-mutable-collection-classes.html">具象可変コレクションクラス</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/arrays.html">配列</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/strings.html">文字列</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/performance-characteristics.html">性能特性</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/equality.html">等価性</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/views.html">ビュー</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/iterators.html">イテレータ</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/creating-collections-from-scratch.html">コレクションの作成</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/conversions-between-java-and-scala-collections.html">Java と Scala 間のコレクションの変換</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
          
             <!-- if page is a translation, get the translated title -->
              
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  <li><a href="//docs.scala-langja/overviews/collections/migrating-from-scala-27.html">Scala 2.7 からの移行</a></li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            
            
          
        
      </ul>

      
         
         
        <ul id="available-languages" style="display: none;">
          <li><a href="/docs.scala-lang/overviews/collections/concrete-immutable-collection-classes.html">English</a></li>
          
            
            <li><a href="/docs.scala-lang/ja/overviews/collections/concrete-immutable-collection-classes.html" class="lang">日本語</a></li>
          
            
            <li><a href="/docs.scala-lang/zh-cn/overviews/collections/concrete-immutable-collection-classes.html" class="lang">中文 (简体)</a></li>
          
        </ul>
      
		</div>
		<hr>
		<div class="help-us"><a href="https://github.com/scala/docs.scala-lang/blob/master/_ja/overviews/collections/concrete-immutable-collection-classes.md"><i class="fa fa-pencil" aria-hidden="true"></i> Problem with this page?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please help us fix it!</a></div>
	</div>
</div>

	</div>
</section>


</main>

<footer id="site-footer">
    <div class="wrap">
      <div class="site-footer-top">
        
          <ul class="documentation">
            <li><h3>Documentation</h3></li>
            
              <li><a href="/docs.scala-lang/getting-started.html">Getting Started</a></li>
            
              <li><a href="https://www.scala-lang.org/api/current/index.html">API</a></li>
            
              <li><a href="/docs.scala-lang/overviews">Overviews/Guides</a></li>
            
              <li><a href="http://scala-lang.org/files/archive/spec/2.12/">Language Specification</a></li>
            
          </ul>
        
          <ul class="download">
            <li><h3>Download</h3></li>
            
              <li><a href="http://scala-lang.org/download/">Current Version</a></li>
            
              <li><a href="http://scala-lang.org/download/all.html">All versions</a></li>
            
          </ul>
        
          <ul class="community">
            <li><h3>Community</h3></li>
            
              <li><a href="http://scala-lang.org/community/">Community</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#mailing-lists">Mailing Lists</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#chat-rooms">Chat Rooms & More</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#community-libraries-and-tools">Libraries and Tools</a></li>
            
              <li><a href="http://scala.epfl.ch/">The Scala Center</a></li>
            
          </ul>
        
          <ul class="contribute">
            <li><h3>Contribute</h3></li>
            
              <li><a href="http://scala-lang.org/contribute/">How to help</a></li>
            
              <li><a href="http://scala-lang.org/contribute/bug-reporting-guide.html">Report an Issue</a></li>
            
          </ul>
        
          <ul class="scala">
            <li><h3>Scala</h3></li>
            
              <li><a href="http://scala-lang.org/blog/">Blog</a></li>
            
              <li><a href="http://scala-lang.org/conduct/">Code of Conduct</a></li>
            
              <li><a href="http://scala-lang.org/license/">License</a></li>
            
          </ul>
        
          <ul class="social">
            <li><h3>Social</h3></li>
            
              <li><a href="https://github.com/scala/scala">GitHub</a></li>
            
              <li><a href="https://twitter.com/scala_lang">Twitter</a></li>
            
          </ul>
        
      </div>
      <div class="site-footer-bottom">
        <p></p>
        <img src="/docs.scala-lang/resources/img/frontpage/scala-logo-white.png" alt="">
      </div>
    </div>
    <a class="back-to-top in" href="#" id="scroll-to-top-btn">
      <i class="fa fa-angle-up"></i>
    </a>
</footer>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
<script>(window.jQuery) || document.write('<script src="/docs.scala-lang/scripts/jquery-3.1.1.min.js"><\/script>');</script>
<script src="/docs.scala-lang/resources/js/vendor/jquery.autocomplete.js" type="text/javascript"></script>

<!-- moment js -->
<script src="/docs.scala-lang/resources/js/vendor/moment.min.js" type="text/javascript"></script>

<!-- tweet feed -->
<script src="/docs.scala-lang/resources/js/tweetMachine-update.js" type="text/javascript"></script>

<!-- prettify js -->
<script src="/docs.scala-lang/resources/js/vendor/prettify/prettify.js" type="text/javascript"></script>
<script src="/docs.scala-lang/resources/js/vendor/prettify/lang-scala.js" type="text/javascript"></script>

<!-- unslider js -->
<script src="/docs.scala-lang/resources/js/vendor/unslider.js" type="text/javascript"></script>

<!-- Highlight -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/scala.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/java.min.js" type="text/javascript"></script>

<!-- CodeMirror -->
<script src="/docs.scala-lang/resources/js/vendor/codemirror/codemirror.js" type="text/javascript"></script>
<script src="/docs.scala-lang/resources/js/vendor/codemirror/clike.js" type="text/javascript"></script>

<!-- TOC -->
<script src="/docs.scala-lang/resources/js/vendor/jquery.sticky.js" type="text/javascript"></script>
<script src="/docs.scala-lang/resources/js/vendor/toc.js" type="text/javascript"></script>

<!-- Blog search -->
<script src="/docs.scala-lang/resources/js/vendor/jekyll.search.min.js" type="text/javascript"></script>

<!-- Custom javascript -->
<script src="/docs.scala-lang/resources/js/functions.js" type="text/javascript"></script>



<!-- Alogolia search for doc -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: 'fbc439670f5d4e3730cdcb715c359391',
indexName: 'scala-lang',
inputSelector: '#doc-search-bar',
algoliaOptions: { 'facetFilters': ["language:en"] },
debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
</body>

</html>

